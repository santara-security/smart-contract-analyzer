"use strict";(()=>{var e={};e.id=419,e.ids=[419],e.modules={846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},3033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3873:e=>{e.exports=require("path")},4870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5261:(e,r,s)=>{s.r(r),s.d(r,{patchFetch:()=>R,routeModule:()=>g,serverHooks:()=>v,workAsyncStorage:()=>j,workUnitAsyncStorage:()=>$});var t={};s.r(t),s.d(t,{GET:()=>w});var a=s(6559),i=s(8088),n=s(7719),o=s(2190),l=s(9123);require("fs/promises");var u=s(3873),c=s.n(u),d=s(9021),p=s(9646);let y=(0,require("util").promisify)(p.exec),f=l.B.filter(e=>"base"===e.name);async function h(e,r){let s=`./results/${e}/${r}/analysis.json`,t=c().dirname(c().join(process.cwd(),s));await d.promises.mkdir(t,{recursive:!0});let a=`slither ${e}:${r} --etherscan-apikey NCUY8QN5NU14K513XD4D6KN6DCU63B6NAR --json ${s}`;try{console.log(`Running Slither analysis: ${a}`);let{stdout:s,stderr:t}=await y(a,{cwd:process.cwd(),timeout:3e5,maxBuffer:0xa00000});if(t&&!t.includes("INFO")&&console.warn("Slither stderr:",t),s&&console.log("Slither stdout:",s.substring(0,200)+"..."),!await m(`results/${e}/${r}/analysis.json`))throw Error("Slither analysis completed but no output file was generated");return console.log("Slither analysis completed successfully"),!0}catch(t){if(console.error("Slither analysis failed:",t),t.killed&&"SIGTERM"===t.signal)throw Error("Slither analysis timed out after 5 minutes");let s=await m(`results/${e}/${r}/analysis.json`);if(s)return o.NextResponse.json({tokenAddress:r,chain:e,filePath:`results/${e}/${r}/analysis.json`,result:s});throw Error(`Slither analysis failed: ${t.message}`)}}async function m(e){try{let r=c().join(process.cwd(),e);return await d.promises.access(r),!0}catch(e){return!1}}async function x(e){try{let r=c().join(process.cwd(),e),s=await d.promises.readFile(r,"utf8");return JSON.parse(s)}catch(e){throw Error(`Failed to read file: ${e.message}`)}}async function w(e){let{searchParams:r}=new URL(e.url),s=r.get("tokenAddress"),t=r.get("chain")??f[0]?.name;if(!s)return o.NextResponse.json({error:"tokenAddress is required"},{status:400});if(!l.B.find(e=>e.name===t))return o.NextResponse.json({error:"Invalid chain specified"},{status:400});let a=`results/${t}/${s}/analysis.json`;if(!await m(a))try{console.log(`Analysis file not found for ${t}:${s}. Running Slither analysis...`),await h(t,s),console.log("Slither analysis completed, proceeding to read results...")}catch(e){return console.error("Failed to run Slither analysis:",e),o.NextResponse.json({error:"Failed to run security analysis"},{status:500})}try{let e=await x(a);return e&&e||setTimeout(async()=>{if(!await x(a))throw Error("Analysis file is empty or corrupted")},2e3),console.log(`Successfully read analysis for ${t}:${s}`),o.NextResponse.json({tokenAddress:s,chain:t,filePath:a,result:e})}catch(r){console.error("Failed to read analysis file:",r);let e=await m(a);if(e)return o.NextResponse.json({tokenAddress:s,chain:t,filePath:a,result:e});return o.NextResponse.json({error:`Failed to read analysis file: ${r.message}`},{status:500})}}let g=new a.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/audit/route",pathname:"/api/audit",filename:"route",bundlePath:"app/api/audit/route"},resolvedPagePath:"/mnt/e/javascript/smart-contract-analyzer/src/app/api/audit/route.js",nextConfigOutput:"",userland:t}),{workAsyncStorage:j,workUnitAsyncStorage:$,serverHooks:v}=g;function R(){return(0,n.patchFetch)({workAsyncStorage:j,workUnitAsyncStorage:$})}},6559:(e,r,s)=>{e.exports=s(4870)},9021:e=>{e.exports=require("fs")},9294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},9646:e=>{e.exports=require("child_process")}};var r=require("../../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),t=r.X(0,[719,190,975],()=>s(5261));module.exports=t})();